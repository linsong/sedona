<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html>

<!--

  Copyright (c) 2008 Tridium, Inc
  Licensed under the Academic Free License version 3.0

  History:
    21 Aug 08  Brian Frank  Creation

-->

<!-- TOC-HEADER-START -->
<!-- Auto-generated by sedonac -->
<head>
  <title>Tutorial</title>
  <meta http-equiv='Content-type' content='text/html;charset=UTF-8' />
  <link rel='stylesheet' type='text/css' href='style.css'/>
</head>
<body>
<p>
  <a href='index.html'>
    <img src='logo.png' alt='Sedona'/>
  </a>
</p>
<div class='nav'>
  <a href='index.html'>Index</a>
 | <a href='architecture.html'>Prev</a>
 | <a href='lang.html'>Next</a>
</div>
<h1 class='title'>Tutorial</h1>
<div class='content'>
<!-- TOC-HEADER-END -->

<!--/////////////////////////////////////////////////////////-->
<h1 id="overview">Overview</h1>
<!--/////////////////////////////////////////////////////////-->

<p>
This tutorial takes you through the various development steps
involved in building Sedona applications:
</p>                                     

<ol>
<li>Build a new kit and component</li>
<li>Build a new scode image</li>
<li>Build an application</li>
<li>Run the application</li>
</ol>                       

<p>It is recommended that you read the <a href='architecture.html'>Architecture</a>
chapter before exploring this tutorial.  Refer to the 
<a href='architecture.html#workflow'>diagram</a>, which illustrates the 
work flow this tutorial will take.  Also make sure you have your 
Sedona environment  <a href='setup.html'>setup</a> correctly before.  
</p>
                 
<!--/////////////////////////////////////////////////////////-->
<h1 id="newKit">Build New Kit</h1>
<!--/////////////////////////////////////////////////////////-->

<p>
Kits are modules used to organize Sedona code.  For this
example we will create a new kit called <code>tutorial</code>.
In our kit we will create a component called <code>Add</code>,
which adds to two inputs together.  First let's create a directory
called "tutorial" with two files:
</p>                             

<pre> 
tutorial/
  +- kit.xml
  +- Add.sedona
</pre>         

<p>
For more information see <a href='lang.html#structure'>Structure</a>
to see how kits are organized.
</p>

<p>
The "kit.xml" file is used to define the kit's meta-data for the compiler:
</p>

<pre>
&lt;sedonaKit name="tutorial" vendor="Tridium" description="blah">
  &lt;depend on="sys 1.0" />
  &lt;source dir="." />
&lt;/sedonaKit>
</pre>       

<p>
The "kit.xml" file specifies the name of our kit, a short description,
dependencies, and the directories of source code. The vendor attribute
specifies the company who developed the kit - for the purposes of the tutorial
leave this as "Tridium" because otherwise the kit name must be prefixed with
the name. For more information see <a href='kits.html'>Kits</a> and 
<a href='sedonac.html#compileKit'>Sedonac</a>.
</p>    

<p>
The "Add.sedona" file defines the Sedona source code for our new component:
</p>

<pre>
public class Add extends Component
{
  property float out
  property float in1
  property float in2

  override void execute() { out = in1 + in2 }
}                 
</pre>

<p>
The Add component is pretty simple - it declares two inputs and an output.
When the component is "executed" we add the two inputs and update the
output.  For more information see <a href='components.html'>Components</a>.
</p>

<p>
To compile our new kit we just need to run sedonac against our directory
or the "kit.xml" file:
</p>                    

<pre>          
D:\sedona\src\tutorial>dir

 Directory of D:\sedona\src\tutorial

01/19/2009  01:55 PM   149 Add.sedona
01/19/2009  01:55 PM   258 kit.xml

D:\sedona\src\tutorial>sedonac kit.xml
  Parse [1 files]
  WriteKit [D:\sedona\kits\tutorial\tutorial-89858e3e-1.0.30.kit]
*** Success! ***
</pre>           

<p>
If successful, you should have a new kit file in your
"kits/tutorial" directory.  You can open this file in a tool like
WinZip to explore the compiler's output.  For more information
see <a href='sedonac.html#compileKit'>Sedonac</a>.  If you have
trouble running sedonac, then see <a href='setup.html'>Setup</a>.
</p>

<!--/////////////////////////////////////////////////////////-->
<h1 id="newImage">Build New Scode Image</h1>
<!--/////////////////////////////////////////////////////////-->

<p>
Kits are units of deployment, but are not run directly by the 
Sedona VM.  First we have to compile a set of kits into an scode
image which can be run directly by the Sedona VM.  Create a new 
directory called "tutorialApp" with one file:
</p>                  

<pre> 
tutorialApp/
  +- code.xml
</pre>         

<p>
The "code.xml" file specifies the kits we wist to compile into
an image:
</p>

<pre>
&lt;sedonaCode 
  name = "code" endian="little" blockSize="4"
  refSize="4" main="sys::Sys.main" debug="true" test="true"
&gt;
  &lt;depend on="sys 1.0" /&gt;
  &lt;depend on="sox 1.0" /&gt;
  &lt;depend on="inet 1.0" /&gt;
  &lt;depend on="web 1.0" /&gt;
  &lt;depend on="control 1.0" /&gt;
  &lt;depend on="tutorial 1.0" /&gt;
&lt;/sedonaCode&gt;
</pre>

<p>
If you are running on 32-bit x86 then you can use the exact file 
listed above.  Otherwise you might need to tweak your settings for
endian and refSize.  See <a href='sedonac.html#compileCode'>Sedonac</a> 
for more information.
</p>              

<p>
Run sedonac on this file to produce an scode image:
</p>

<pre>              
D:\sedona\tutorialApp>sedonac code.xml
  ReadKits [6 kits]
  WriteImage [D:\sedona\tutorialApp\code.scode] (79340 bytes)
  +----------------------------------
  |  Data:      6.3kb (6448 bytes)
  |  Code:     77.5kb (79340 bytes)
  |  Total:    83.8kb (85788 bytes)
  +----------------------------------
*** Success! ***

D:\sedona\tutorialApp>dir

 Directory of D:\sedona\baseline\pub\tutorialApp

01/19/2009  02:24 PM    79,340 code.scode
01/19/2009  02:20 PM       342 code.xml
</pre>

<p>
If successful, then you should have now have a "code.scode" file.
</p>


<!--/////////////////////////////////////////////////////////-->
<h1 id="newApp">Build New App</h1>
<!--/////////////////////////////////////////////////////////-->

<p>
Sedona is a component oriented language which enables you to 
build new applications by assembling components.  The application
file stores a tree of components, their configuration properties,
and how they are linked together.  Typically applications are built
with graphical tools.  For this tutorial we will hand code an 
application file using XML.  In the "tutorialApp" directory let's
create a new "app.sax" file:
</p>          

<pre>                    
&lt;sedonaApp>
&lt;schema>
  &lt;kit name='sys'/>
  &lt;kit name='sox'/>
  &lt;kit name='inet'/>
  &lt;kit name='web'/>
  &lt;kit name='control'/>
  &lt;kit name='tutorial'/>
&lt;/schema>
&lt;app>
  &lt;comp name="plat" type="sys::PlatformService"/>
  &lt;comp name="users" type="sys::UserService">
    &lt;comp name="admin" type="sys::User">
      &lt;prop name="cred" val="hE49ksThgAeLkWB3NUU1NWeDO54="/>
      &lt;prop name="perm" val="2147483647"/>
      &lt;prop name="prov" val="255"/>
    &lt;/comp>
  &lt;/comp>
  &lt;comp name="sox" type="sox::SoxService"/>
  &lt;comp name="web" type="web::WebService">  
    &lt;prop name="port" val="8080"/>
  &lt;/comp>
  &lt;comp name="rampA" type="control::Ramp"/>
  &lt;comp name="rampB" type="control::Ramp"/>
  &lt;comp name="add"   type="tutorial::Add" id="12"/>
&lt;/app>
&lt;links>
  &lt;link from="/rampA.out" to="/add.in1"/>
  &lt;link from="/rampB.out" to="/add.in2"/>
&lt;/links>
&lt;/sedonaApp>
</pre>

<p>
The file above declares four components. The <code>WebService</code> component
will run an HTTP server so we can use a browser for debugging. We set the web
server's port to 8080. We declare two <code>control::Ramp</code> components
which are used to generate dummy data. Finally we declare a <code>tutorial::Add</code> 
component which is the component we built ourselves in the step above. 
The links section is used to link the output of the two ramps to the 
inputs of our <code>Add</code> block to create control flow.
</p>

<p>
Sedona devices don't run the XML file directly, so now we need
to compile the XML into a binary format that the Sedona VM can
use directly.  Do this by running sedonac on "app.sax":                 
</p>

<pre>
D:\sedona\tutorialApp>sedonac app.sax
  ConvertAppFile [D:\sedona\tutorialApp\app.sax -> D:\sedona\tutorialApp\app.sab]
  +----------------------------------
  |  RAM:     12.1kb (12432 bytes)
  |  FLASH:    0.2kb (207 bytes)
  +----------------------------------
*** Success! ***
</pre>          

<p>
Now we should have a file called "app.sab".  See <a href='apps.html'>Apps</a> 
for more information.
</p>               

<!--/////////////////////////////////////////////////////////-->
<h1 id="runApp">Run App</h1>
<!--/////////////////////////////////////////////////////////-->

<p>
If you have followed the steps above, we have:
</p>

<ul>
<li>Built a new kit called "tutorial" with a component called "Add"</li>
<li>Compiled our new kit into an scode image called "code.scode"</li>
<li>Defined and compiled an app into a file called "app.sab"</li>
</ul>

<p>
At this point we can run our application using the Sedona VM.  Assuming
we are running on Windows we can run our application as follows:
</p>

<pre>                          
D:\sedona\tutorialApp>svm code.scode app.sab

Sedona VM 1.0
buildDate: Dec  2 2008 12:58:55
endian:    little
blockSize: 4
refSize:   4

-- MESSAGE [sys::App] starting
-- MESSAGE [sox::SoxService] started port=1876
-- MESSAGE [web::WebService] started port=8080
-- MESSAGE [sys::App] running
</pre>                        

<p>
We just pass our code and application filenames to the "svm.exe" executable.
If you are running on an alternate platform, you might need to compile the
SVM from source - see <a href='porting.html'>Porting</a>.
</p>     

<p>
Assuming you have your SVM running the application, you should be able
to hit it with your browser at <a href='http://localhost:8080/'>http://localhost:8080/</a>.
If you go to the URL <a href='http://localhost:8080/spy/app/12'>http://localhost:8080/spy/app/12</a> 
you should see the current values of your <code>tutorial::Add</code> component.  
Hit refresh a couple times to see how the inputs and output change in real-time.
</p>

<p>
If you have a programming tool such as the Sedona Workbench, you should now
be able to connect to Sox port 1876 with the username "admin" and password
of "".  Refer to your Sedona tool documentation for more information.
</p> 

<p>
Congratulations, you've just built and deployed your first Sedona
application!  Remember this tutorial illustrates the very basics 
using only the command line tools.  Visit 
<a href='http://www.sedonadev.org/'>sedonadev.org</a> to learn more
about the Sedona tools available.
</p>

<!-- TOC-FOOTER-START -->
<!-- Auto-generated by sedonac -->
</div>
<div class='nav'>
  <a href='index.html'>Index</a>
 | <a href='architecture.html'>Prev</a>
 | <a href='lang.html'>Next</a>
</div>
<div class='copyright'>Copyright &#169; 2007-2009 Tridium, Inc.</div>
</body>
<!-- TOC-FOOTER-END -->

</html>







